{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\lanzallamas27\\\\Desktop\\\\CursoReact\\\\ecommerce-cotroneo\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\defineProperty.js\";import _objectSpread from\"C:\\\\Users\\\\lanzallamas27\\\\Desktop\\\\CursoReact\\\\ecommerce-cotroneo\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _asyncToGenerator from\"C:\\\\Users\\\\lanzallamas27\\\\Desktop\\\\CursoReact\\\\ecommerce-cotroneo\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\lanzallamas27\\\\Desktop\\\\CursoReact\\\\ecommerce-cotroneo\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\lanzallamas27\\\\Desktop\\\\CursoReact\\\\ecommerce-cotroneo\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{useState}from\"react\";import{Link}from'react-router-dom';import{useCartContext}from'../../context/CartContext';import{getFirestore,collection,addDoc,query,where,documentId,writeBatch,getDocs}from'firebase/firestore';import{CartList}from'../CartList/CartList';import'../../App.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var Cart=function Cart(){var _useCartContext=useCartContext(),cartList=_useCartContext.cartList,totalPrice=_useCartContext.totalPrice,emptyCart=_useCartContext.emptyCart;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),idOrder=_useState2[0],setIdOrder=_useState2[1];var _useState3=useState({email:'',phone:'',name:''}),_useState4=_slicedToArray(_useState3,2),dataForm=_useState4[0],setDataForm=_useState4[1];var goShopping=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var purchaseOrder,db,ordersCollection,queryCollection,queryUpdateStock,batch;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();purchaseOrder={};purchaseOrder.buyer=dataForm;purchaseOrder.items=cartList.map(function(cartItem){var id=cartItem.item.id;var name=cartItem.item.name;var price=cartItem.item.price*cartItem.quantity;var quantity=cartItem.quantity;return{id:id,name:name,price:price,quantity:quantity};});purchaseOrder.total=totalPrice();db=getFirestore();ordersCollection=collection(db,'orders');_context.next=9;return addDoc(ordersCollection,purchaseOrder).then(function(resp){return setIdOrder(resp.id);});case 9:queryCollection=collection(db,'items');queryUpdateStock=query(queryCollection,where(documentId(),'in',cartList.map(function(it){return it.item.id;})));batch=writeBatch(db);_context.next=14;return getDocs(queryUpdateStock).then(function(resp){return resp.docs.forEach(function(res){return batch.update(res.ref,{stock:res.data().stock-cartList.find(function(item){return item.item.id===res.id;}).quantity});});}).catch(function(err){return console.log(err);}).finally(function(){setDataForm({email:'',phone:'',name:''});emptyCart();});case 14:batch.commit();case 15:case\"end\":return _context.stop();}}},_callee);}));return function goShopping(_x){return _ref.apply(this,arguments);};}();var handleChange=function handleChange(event){setDataForm(_objectSpread(_objectSpread({},dataForm),{},_defineProperty({},event.target.name,event.target.value)));};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"shoppingCart__idOrder center\",children:idOrder!==''&&\"Muchas Gracias por su compra!! El id de su orden es: \".concat(idOrder)}),cartList.length!==0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CartList,{}),/*#__PURE__*/_jsxs(\"form\",{className:\"form\",onSubmit:goShopping,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",placeholder:\"Nombre\",onChange:handleChange,value:dataForm.name}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",name:\"phone\",placeholder:\"Tel\\xE9fono\",onChange:handleChange,value:dataForm.phone}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",placeholder:\"E-mail\",onChange:handleChange,value:dataForm.email}),/*#__PURE__*/_jsx(\"button\",{className:\"form__button\",children:\"Procesar Orden\"})]})]}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"shoppingCart__messageTitle\",children:\"Tu carrito est\\xE1 ahora vac\\xEDo!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"shoppingCart__message\",children:\"Tenemos los mejores productos para tus mascotas, te invitamos a visitar nuestra tienda.\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"button\",{className:\"shoppingCart__button\",children:\"Ir a Nuestra Tienda\"})})]})})]});};","map":{"version":3,"sources":["C:/Users/lanzallamas27/Desktop/CursoReact/ecommerce-cotroneo/src/components/Cart/Cart.jsx"],"names":["useState","Link","useCartContext","getFirestore","collection","addDoc","query","where","documentId","writeBatch","getDocs","CartList","Cart","cartList","totalPrice","emptyCart","idOrder","setIdOrder","email","phone","name","dataForm","setDataForm","goShopping","e","preventDefault","purchaseOrder","buyer","items","map","cartItem","id","item","price","quantity","total","db","ordersCollection","then","resp","queryCollection","queryUpdateStock","it","batch","docs","forEach","res","update","ref","stock","data","find","catch","err","console","log","finally","commit","handleChange","event","target","value","length"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\r\nimport { Link } from 'react-router-dom'\r\nimport { useCartContext } from '../../context/CartContext';\r\nimport { getFirestore, collection, addDoc, query, where, documentId, writeBatch, getDocs } from 'firebase/firestore'\r\nimport { CartList } from '../CartList/CartList';\r\nimport '../../App.css'\r\n\r\n\r\nexport const Cart = () => {\r\n\r\n  const { cartList, totalPrice, emptyCart } = useCartContext();\r\n\r\n  const [ idOrder, setIdOrder ] = useState('');\r\n\r\n  const [ dataForm, setDataForm ] = useState({\r\n      email: '',\r\n      phone: '',\r\n      name: ''\r\n  })\r\n\r\n  const goShopping = async (e) => {\r\n      e.preventDefault()  \r\n           \r\n      let purchaseOrder = {}\r\n         \r\n      purchaseOrder.buyer = dataForm;\r\n      purchaseOrder.items = cartList.map ( cartItem => {\r\n          const id = cartItem.item.id;\r\n          const name = cartItem.item.name;\r\n          const price = cartItem.item.price * cartItem.quantity;\r\n          const quantity = cartItem.quantity\r\n          \r\n          return {\r\n              id, \r\n              name, \r\n              price, \r\n              quantity\r\n          }   \r\n      }) \r\n      purchaseOrder.total = totalPrice(); \r\n     \r\n      const db = getFirestore()\r\n      const ordersCollection = collection (db, 'orders')\r\n      await addDoc( ordersCollection, purchaseOrder)\r\n      .then(resp => setIdOrder(resp.id))\r\n      \r\n      \r\n      const queryCollection = collection(db, 'items')\r\n          \r\n      const queryUpdateStock = query(\r\n          queryCollection, \r\n          where ( documentId() , 'in', cartList.map ( it => it.item.id ) )          \r\n      ) \r\n  \r\n      const batch = writeBatch(db)\r\n  \r\n      await getDocs(queryUpdateStock)\r\n      .then(resp => resp.docs.forEach(res => batch.update(res.ref, {\r\n              stock: res.data().stock - cartList.find(item => item.item.id === res.id).quantity\r\n           })\r\n      ))\r\n      .catch(err => console.log(err))\r\n      .finally(() => { \r\n        setDataForm({\r\n          email: '',\r\n          phone: '',\r\n          name: ''\r\n        })\r\n        emptyCart();\r\n      })\r\n          \r\n  \r\n      batch.commit()\r\n  \r\n    }\r\n\r\n  const handleChange = (event) => {      \r\n      setDataForm({ \r\n          ...dataForm,\r\n          [event.target.name]: event.target.value\r\n      })\r\n  }\r\n\r\n  return (\r\n\r\n    <div className=\"container\">\r\n      <div className=\"shoppingCart__idOrder center\">\r\n        {idOrder !== '' && `Muchas Gracias por su compra!! El id de su orden es: ${idOrder}` }\r\n      </div>\r\n      { cartList.length !== 0 ? \r\n        <>\r\n        <CartList/>\r\n        <form className= \"form\" onSubmit={goShopping}>\r\n                <input \r\n                    type='text' \r\n                    name='name' \r\n                    placeholder='Nombre' \r\n                    onChange={handleChange}\r\n                    value={dataForm.name}\r\n                />\r\n\r\n                <input \r\n                    type='tel' \r\n                    name='phone'\r\n                    placeholder='Teléfono' \r\n                    onChange={handleChange}\r\n                    value={dataForm.phone}\r\n                />\r\n\r\n                <input \r\n                    type='email' \r\n                    name='email'\r\n                    placeholder='E-mail' \r\n                    onChange={handleChange}\r\n                    value={dataForm.email}\r\n                />  \r\n              <button className=\"form__button\">Procesar Orden</button>\r\n            </form>\r\n        </>\r\n      :   \r\n        <>   \r\n          <div className=\"center\">\r\n            <h2 className=\"shoppingCart__messageTitle\">Tu carrito está ahora vacío!</h2>\r\n              <p className=\"shoppingCart__message\">Tenemos los mejores productos para tus mascotas, te invitamos a visitar nuestra tienda.</p>\r\n              <Link to='/'>\r\n                <button className=\"shoppingCart__button\">Ir a Nuestra Tienda</button>\r\n              </Link>\r\n          </div>\r\n        </> \r\n      }\r\n    </div>\r\n\r\n  )\r\n\r\n};\r\n"]},"metadata":{},"sourceType":"module"}