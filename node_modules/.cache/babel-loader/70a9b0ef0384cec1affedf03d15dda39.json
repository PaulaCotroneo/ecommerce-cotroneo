{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\lanzallamas27\\\\Desktop\\\\CursoReact\\\\ecommerce-cotroneo\\\\src\\\\components\\\\Cart\\\\Cart.jsx\",\n    _s = $RefreshSig$();\n\nimport { useCartContext } from '../../context/CartContext';\nimport { Link } from 'react-router-dom';\nimport { getFirestore, collection, addDoc, query, where, documentId, writeBatch, getDocs } from 'firebase/firestore';\nimport '../../App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const Cart = () => {\n  _s();\n\n  const {\n    cartList,\n    precioTotal,\n    eliminarDelCarrito,\n    vaciarCarrito\n  } = useCartContext();\n\n  const realizarCompra = async e => {\n    e.preventDefault();\n    let orden = {};\n    orden.date = Timestamp.fromDate(new Date());\n    orden.buyer = {\n      name: 'Paula',\n      email: 'pau@gmail.com',\n      phone: '1234567890'\n    };\n    orden.items = cartList.map(cartItem => {\n      const id = cartItem.item.id;\n      const nombre = cartItem.item.nombre;\n      const precio = cartItem.item.precio * cartItem.cantidad;\n      const cantidad = cartItem.cantidad;\n      return {\n        id,\n        nombre,\n        precio,\n        cantidad\n      };\n    });\n    orden.total = precioTotal();\n    console.log(orden);\n    const db = getFirestore();\n    const ordersCollection = collection(db, 'orders');\n    await addDoc(ordersCollection, orden).then(resp => console.log(resp));\n    const queryCollection = collection(db, 'items');\n    const queryActulizarStock = query(queryCollection, where(documentId(), 'in', cartList.map(it => it.item.id)));\n    const batch = writeBatch(db);\n    await getDocs(queryActulizarStock).then(resp => resp.docs.forEach(res => batch.update(res.ref, {\n      stock: res.data().stock - cartList.find(item => item.item.id === res.id).cantidad\n    }))).catch(err => console.log(err)).finally(() => console.log('Se actualiza el Stock'));\n    batch.commit();\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"contenedor\",\n    children: cartList.length !== 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [cartList.map(produ => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"carrito\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"carrito__imagen\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: produ.item.imagen,\n            alt: produ.item.descripImagen\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 67,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"carrito__nombre\",\n          children: produ.item.nombre\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"carrito__precio\",\n          children: [\"$\", produ.item.precio]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"carrito__cantidad\",\n          children: produ.cantidad\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"carrito__eliminar\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"borrar-producto\",\n            onClick: () => eliminarDelCarrito(produ.item.id),\n            children: \"x\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 9\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"carrito__precioTotal\",\n        children: `Total a Pagar: $${precioTotal()}`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"carrito__btn\",\n        onClick: vaciarCarrito,\n        children: \"Vaciar Carrito\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"carrito__btn\",\n        onClick: realizarCompra,\n        children: \"Crear Orden\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"carrito__mensaje\",\n        children: \"El carrito est\\xE1 vac\\xEDo!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"carrito__btn\",\n          children: \"Conoce Nuestros Productos\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Cart, \"6laP4FMObh8qz2CG6TZUERxBnq0=\", false, function () {\n  return [useCartContext];\n});\n\n_c = Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"sources":["C:/Users/lanzallamas27/Desktop/CursoReact/ecommerce-cotroneo/src/components/Cart/Cart.jsx"],"names":["useCartContext","Link","getFirestore","collection","addDoc","query","where","documentId","writeBatch","getDocs","Cart","cartList","precioTotal","eliminarDelCarrito","vaciarCarrito","realizarCompra","e","preventDefault","orden","date","Timestamp","fromDate","Date","buyer","name","email","phone","items","map","cartItem","id","item","nombre","precio","cantidad","total","console","log","db","ordersCollection","then","resp","queryCollection","queryActulizarStock","it","batch","docs","forEach","res","update","ref","stock","data","find","catch","err","finally","commit","length","produ","imagen","descripImagen"],"mappings":"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","sourcesContent":["import { useCartContext } from '../../context/CartContext';\r\nimport { Link } from 'react-router-dom';\r\nimport { getFirestore, collection, addDoc, query, where, documentId, writeBatch, getDocs } from 'firebase/firestore'\r\nimport '../../App.css'\r\n\r\n\r\nexport const Cart = () => {\r\n\r\n  const { cartList, precioTotal, eliminarDelCarrito, vaciarCarrito } = useCartContext();\r\n\r\n  const realizarCompra = async (e) => {\r\n    e.preventDefault()  \r\n         \r\n    let orden = {}\r\n    orden.date = Timestamp.fromDate(new Date())        \r\n    orden.buyer = {name:'Paula',email: 'pau@gmail.com', phone: '1234567890'}\r\n    orden.items = cartList.map(cartItem => {\r\n        const id = cartItem.item.id;\r\n        const nombre = cartItem.item.nombre;\r\n        const precio = cartItem.item.precio * cartItem.cantidad;\r\n        const cantidad = cartItem.cantidad\r\n        \r\n        return {\r\n            id, \r\n            nombre, \r\n            precio, \r\n            cantidad\r\n        }   \r\n    }) \r\n    orden.total = precioTotal(); \r\n\r\n    console.log(orden)\r\n    \r\n    const db = getFirestore()\r\n    const ordersCollection = collection (db, 'orders')\r\n    await addDoc( ordersCollection, orden)\r\n    .then(resp => console.log(resp))\r\n    \r\n    const queryCollection = collection(db, 'items')\r\n        \r\n    const queryActulizarStock = query(\r\n        queryCollection, \r\n        where ( documentId() , 'in', cartList.map(it => it.item.id) )          \r\n    ) \r\n\r\n    const batch = writeBatch(db)\r\n\r\n    await getDocs(queryActulizarStock)\r\n    .then(resp => resp.docs.forEach(res => batch.update(res.ref, {\r\n            stock: res.data().stock - cartList.find(item => item.item.id === res.id).cantidad\r\n         })\r\n    ))\r\n    .catch(err => console.log(err))\r\n    .finally(() =>console.log('Se actualiza el Stock'))\r\n\r\n    batch.commit()\r\n\r\n  }\r\n\r\n\r\n  return (\r\n    <div className=\"contenedor\">\r\n      { cartList.length !== 0 ? <>\r\n        { cartList.map(produ => \r\n        <div className=\"carrito\">  \r\n          <div className=\"carrito__imagen\">\r\n            <img src={produ.item.imagen} alt={produ.item.descripImagen}/>\r\n          </div>\r\n          <div className=\"carrito__nombre\">{produ.item.nombre}</div>\r\n          <div className=\"carrito__precio\">${produ.item.precio}</div>\r\n          <div className=\"carrito__cantidad\">{produ.cantidad}</div>\r\n          <div className=\"carrito__eliminar\">\r\n            <button className=\"borrar-producto\" onClick={() => eliminarDelCarrito(produ.item.id)}>x</button>\r\n          </div>\r\n        </div> \r\n        ) }\r\n        <div className=\"carrito__precioTotal\">\r\n          {`Total a Pagar: $${precioTotal()}`}\r\n        </div>\r\n        <button className=\"carrito__btn\" onClick={vaciarCarrito}>Vaciar Carrito</button>\r\n        <button className=\"carrito__btn\" onClick={realizarCompra}>Crear Orden</button>\r\n        </>\r\n      :   \r\n        <>   \r\n        <h2 className=\"carrito__mensaje\">El carrito está vacío!</h2>\r\n        <Link to='/'>\r\n          <button className=\"carrito__btn\">Conoce Nuestros Productos</button>\r\n        </Link>\r\n        </> \r\n      }\r\n    </div>\r\n  )\r\n\r\n};\r\n"]},"metadata":{},"sourceType":"module"}